<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <!-- Viewport ajustado para comportamento de app nativo -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>10k em Silﾃｪncio</title>
    
    <!-- === PWA & ﾃ垢ONES === -->
    <link rel="icon" type="image/png" href="icon.png?v=3">
    <link rel="apple-touch-icon" href="icon.png?v=3">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f172a">
    <meta name="mobile-web-app-capable" content="yes">
    
    <link rel="manifest" href='data:application/manifest+json,{"name":"10k em Silﾃｪncio","short_name":"10k","start_url":".","display":"standalone","orientation":"portrait","background_color":"#0f172a","theme_color":"#10b981","icons":[{"src":"icon.png?v=3","sizes":"512x512","type":"image/png"}]}'>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'slide-up': 'slideUp 0.5s ease-out forwards',
                        'blob': 'blob 7s infinite',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        }
                    }
                },
            },
        }
    </script>

    <!-- ImportMap -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom": "https://esm.sh/react-dom@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.344.0?external=react",
            "recharts": "https://esm.sh/recharts@2.12.2?external=react,react-dom",
            "clsx": "https://esm.sh/clsx@2.0.0",
            "tailwind-merge": "https://esm.sh/tailwind-merge@1.14.0"
        }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Trava a rolagem do body para evitar barra de URL no Android */
        html, body { 
            height: 100%; 
            width: 100%;
            overflow: hidden; 
            overscroll-behavior-y: none; 
            background-color: #0f172a;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 2px; }
    </style>
</head>
<body class="bg-slate-900 text-slate-50 flex justify-center">

    <div id="root" class="w-full max-w-md h-full relative bg-slate-900 shadow-2xl overflow-hidden"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import * as LucideIcons from 'lucide-react';
        import { 
          PieChart, Pie, Cell, ResponsiveContainer, Tooltip as RechartsTooltip, 
          Legend, BarChart, Bar, XAxis, YAxis, LabelList, AreaChart, Area, CartesianGrid, Tooltip 
        } from 'recharts';
        import { clsx } from 'clsx';
        import { twMerge } from 'tailwind-merge';

        function cn(...inputs) { return twMerge(clsx(inputs)); }
        
        const { 
            Trophy, Target, TrendingUp, Shield, Crown, Ghost, Lock, Unlock, 
            Plus, History, Trash2, AlertTriangle, Wallet, ArrowRight, Save, 
            CheckCircle2, X, Medal, Sparkles, Quote, Lightbulb, ArrowLeft, 
            Home, User, Users, LogOut, Mountain, LayoutGrid, Search, 
            ShoppingBag, Coffee, Smartphone, Car, CreditCard, ShieldCheck, 
            Zap, Clock, Briefcase, Calendar, ShieldBan, Copy, Check, MessageSquare, 
            Shuffle, Banknote, RotateCcw, Settings, XCircle, ArrowLeftRight, Sun, 
            Percent, RefreshCw, RefreshCcw, BookOpen, AlertCircle, DollarSign, PiggyBank,
            Download, Share
        } = LucideIcons;

        // --- Prompt de Instalaﾃｧﾃ｣o ---
        function InstallPrompt() {
            const [showPrompt, setShowPrompt] = useState(false);
            const [deferredPrompt, setDeferredPrompt] = useState(null);
            const [isIOS, setIsIOS] = useState(false);

            useEffect(() => {
                const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
                const hasSeenPrompt = localStorage.getItem('install_prompt_seen_v2');
                if (isStandalone || hasSeenPrompt) return;

                const ios = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
                setIsIOS(ios);

                if (ios) {
                    setShowPrompt(true);
                } else {
                    const handleBeforeInstallPrompt = (e) => {
                        e.preventDefault();
                        setDeferredPrompt(e);
                        setShowPrompt(true);
                    };
                    window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);
                    return () => window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);
                }
            }, []);

            const handleInstallClick = async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    if (outcome === 'accepted') setShowPrompt(false);
                    setDeferredPrompt(null);
                }
            };

            const handleDismiss = () => {
                setShowPrompt(false);
                localStorage.setItem('install_prompt_seen_v2', 'true');
            };

            if (!showPrompt) return null;

            return (
                <div className="absolute inset-0 z-[9999] flex items-end justify-center bg-black/60 backdrop-blur-sm animate-fade-in p-4 pb-8">
                    <div className="bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl animate-slide-up">
                        <div className="flex justify-between items-start mb-4">
                            <div className="flex items-center gap-3">
                                <div className="w-12 h-12 bg-slate-900 rounded-xl flex items-center justify-center text-emerald-400 border border-slate-700 shadow-md"><span className="text-2xl">洶</span></div>
                                <div><h3 className="text-lg font-bold text-slate-900">Instalar App</h3><p className="text-xs text-slate-500">10k em Silﾃｪncio</p></div>
                            </div>
                            <button onClick={handleDismiss} className="text-slate-400 hover:text-slate-600"><X size={20} /></button>
                        </div>
                        {isIOS ? (
                            <div className="space-y-3">
                                <p className="text-sm text-slate-600">Para instalar no iPhone:</p>
                                <div className="flex items-center gap-3 text-sm text-slate-700 bg-slate-50 p-3 rounded-lg border border-slate-100">1. Toque em <Share size={16} className="text-blue-500" /> <strong>Compartilhar</strong></div>
                                <div className="flex items-center gap-3 text-sm text-slate-700 bg-slate-50 p-3 rounded-lg border border-slate-100">2. Escolha <span className="flex items-center gap-1 font-bold"><Plus size={14} className="border border-black rounded-[4px] p-px" /> Adicionar ﾃ Tela de Inﾃｭcio</span></div>
                                <button onClick={handleDismiss} className="w-full mt-2 py-3 bg-slate-100 text-slate-600 font-bold rounded-xl">Entendi</button>
                            </div>
                        ) : (
                            <div className="space-y-4">
                                <p className="text-sm text-slate-600">Adicione ﾃ sua tela inicial para acesso rﾃ｡pido e tela cheia.</p>
                                <button onClick={handleInstallClick} className="w-full py-4 bg-emerald-600 hover:bg-emerald-700 text-white font-bold rounded-xl shadow-lg flex items-center justify-center gap-2 active:scale-95 transition-all"><Download size={20} />Instalar Agora</button>
                                <button onClick={handleDismiss} className="w-full py-2 text-xs font-bold text-slate-400 hover:text-slate-600">Agora nﾃ｣o</button>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // --- Utils Comuns ---
        const formatCurrency = (value) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);

        // ==========================================
        // 1. EMPILHADOR
        // ==========================================
        const EMPILHADOR_LEVELS = [
          { id: 1, threshold: 0, title: "Novato Consciente", icon: Wallet, color: "text-slate-500", bg: "bg-slate-100" },
          { id: 2, threshold: 20, title: "O Invisﾃｭvel", icon: Ghost, color: "text-blue-500", bg: "bg-blue-100" },
          { id: 3, threshold: 50, title: "Escudo de Proteﾃｧﾃ｣o", icon: Shield, color: "text-emerald-500", bg: "bg-emerald-100" },
          { id: 4, threshold: 75, title: "Guerreiro Intocﾃ｡vel", icon: Trophy, color: "text-purple-500", bg: "bg-purple-100" },
          { id: 5, threshold: 100, title: "Soberano da Liberdade", icon: Crown, color: "text-amber-500", bg: "bg-amber-100" },
        ];
        const EMPILHADOR_QUOTES = ["Cada centavo ﾃｩ um soldado.", "O futuro agradece.", "Persistﾃｪncia ﾃｩ o segredo.", "Dinheiro guardado ﾃｩ tranquilidade.", "O hﾃ｡bito vale mais que a intensidade."];

        function Empilhador_CreateUser({ onBack, onCreate }) {
            const [name, setName] = useState('');
            const [goal, setGoal] = useState('');
            const handleSubmit = (e) => { e.preventDefault(); if (name && goal) { const goalVal = parseFloat(goal.replace(/\./g, '').replace(',', '.')); if (goalVal > 0) onCreate(name, goalVal); } };
            return (
                <div className="w-full h-full bg-white p-6 flex flex-col pb-24 overflow-y-auto animate-fade-in">
                    <button onClick={onBack} className="self-start text-slate-400 mb-6 flex items-center gap-1 text-sm font-medium"><ArrowLeft size={18} /> Voltar</button>
                    <div className="text-center mb-8"><div className="w-16 h-16 bg-emerald-100 rounded-full flex justify-center items-center mx-auto mb-4"><Target className="w-8 h-8 text-emerald-600" /></div><h1 className="text-2xl font-bold text-slate-800">Defina seu Tesouro</h1></div>
                    <form onSubmit={handleSubmit} className="space-y-4 flex-1">
                        <div><label className="block text-sm font-medium text-slate-700 mb-1">Nome do Perfil</label><input type="text" className="w-full p-4 border rounded-xl text-slate-900" value={name} onChange={e => setName(e.target.value)} required /></div>
                        <div><label className="block text-sm font-medium text-slate-700 mb-1">Meta (R$)</label><input type="number" className="w-full p-4 border rounded-xl text-slate-900" value={goal} onChange={e => setGoal(e.target.value)} required /></div>
                        <button type="submit" className="w-full bg-slate-900 text-white font-bold py-4 rounded-xl mt-4">Criar Cofre</button>
                    </form>
                </div>
            );
        }

        function Empilhador_InternalDashboard({ user, onUpdateData, onLogout, view, setView }) {
            const [inputValue, setInputValue] = useState('');
            const [showConfetti, setShowConfetti] = useState(false);
            const [showSaveFeedback, setShowSaveFeedback] = useState(false);
            const [showResetModal, setShowResetModal] = useState(false);
            
            const percentage = useMemo(() => user.goal === 0 ? 0 : Math.min(100, Math.max(0, (user.currentAmount / user.goal) * 100)), [user.currentAmount, user.goal]);
            const currentLevel = useMemo(() => [...EMPILHADOR_LEVELS].reverse().find(l => percentage >= l.threshold) || EMPILHADOR_LEVELS[0], [percentage]);
            
            const handleAddMoney = (e) => {
                e.preventDefault();
                const val = parseFloat(inputValue.replace(/\./g, '').replace(',', '.'));
                if (!isNaN(val) && val > 0) {
                    const newAmount = user.currentAmount + val;
                    const newHistory = [{ id: Date.now(), amount: val, date: new Date().toLocaleDateString('pt-BR') }, ...user.history];
                    onUpdateData(newAmount, newHistory);
                    setInputValue(''); setShowConfetti(true); setShowSaveFeedback(true); setTimeout(() => { setShowConfetti(false); setShowSaveFeedback(false); }, 2000);
                }
            };

            return (
                <div className="w-full h-full bg-slate-50 flex flex-col overflow-hidden animate-fade-in">
                    {showResetModal && <div className="absolute inset-0 z-50 bg-black/50 flex items-center justify-center p-4"><div className="bg-white p-6 rounded-2xl w-full max-w-sm"><h3 className="text-lg font-bold mb-2 text-slate-900">Zerar perfil?</h3><div className="flex gap-3"><button onClick={() => setShowResetModal(false)} className="flex-1 py-3 border rounded-xl text-slate-600">Cancelar</button><button onClick={() => { onUpdateData(0, []); setShowResetModal(false); setView('app-home'); }} className="flex-1 py-3 bg-red-500 text-white rounded-xl">Sim, zerar</button></div></div></div>}
                    <div className="bg-white p-6 pb-8 rounded-b-3xl shadow-sm z-10 pt-10 shrink-0">
                        <div className="flex justify-between items-start mb-6">
                            <div>
                                <div className="flex items-center gap-2 mb-1"><button onClick={onLogout} className="flex items-center gap-1 text-xs font-bold text-slate-400 bg-slate-100 px-2 py-1 rounded-full"><ArrowLeft size={12} /> Trocar</button><h2 className="text-sm font-bold text-slate-400 uppercase truncate max-w-[150px]">{user.name}</h2></div>
                                <div className="flex items-baseline gap-1 mt-1"><span className="text-3xl font-extrabold text-slate-900">{formatCurrency(user.currentAmount)}</span><span className="text-sm text-slate-500"> / {formatCurrency(user.goal)}</span></div>
                            </div>
                            <button onClick={() => setShowResetModal(true)} className="p-2 text-slate-300 hover:text-red-400"><Trash2 size={18} /></button>
                        </div>
                        <div className="relative pt-2"><div className="h-4 bg-slate-100 rounded-full overflow-hidden"><div className={cn("h-full transition-all duration-1000 relative", percentage >= 100 ? "bg-amber-400" : "bg-emerald-500")} style={{ width: `${percentage}%` }}></div></div></div>
                        <div className={cn("mt-6 p-4 rounded-xl border flex items-center gap-4 transition-all", currentLevel.bg, showConfetti ? "scale-105" : "")}><div className={cn("p-3 rounded-full bg-white", currentLevel.color)}><currentLevel.icon size={24} /></div><div><p className="text-xs font-bold uppercase opacity-70">Nﾃｭvel Atual</p><h3 className="font-bold text-slate-900 text-lg">{currentLevel.title}</h3></div></div>
                    </div>
                    <div className="p-6 space-y-6 flex-1 overflow-y-auto pb-24">
                        {view === 'app-home' ? (
                            <>
                                <button onClick={() => setView('app-add')} className="w-full bg-slate-900 text-white py-4 rounded-xl shadow-lg flex items-center justify-center gap-2 font-bold text-lg"><Plus size={24} className="text-emerald-400" /> Novo Aporte</button>
                                <div><h3 className="text-sm font-bold text-slate-800 mb-3 flex items-center gap-2"><History size={16} /> Histﾃｳrico</h3><div className="space-y-3">{user.history.slice(0, 5).map(item => (<div key={item.id} className="bg-white p-3 rounded-xl border flex justify-between items-center"><span className="text-slate-500 text-xs">{item.date}</span><span className="font-bold text-emerald-600">+{formatCurrency(item.amount)}</span></div>))}</div></div>
                            </>
                        ) : (
                            <div className="bg-white p-5 rounded-2xl shadow-sm border border-slate-100"><label className="block text-sm font-semibold text-slate-700 mb-3">Valor do Aporte</label><form onSubmit={handleAddMoney} className="flex flex-col gap-3"><input type="number" value={inputValue} onChange={e => setInputValue(e.target.value)} className="w-full px-4 py-4 text-xl bg-slate-50 border rounded-xl text-slate-900" autoFocus /><button type="submit" disabled={!inputValue} className="w-full bg-emerald-500 text-white py-4 rounded-xl font-bold">Confirmar</button></form><button onClick={() => setView('app-home')} className="w-full text-slate-400 text-sm mt-4">Cancelar</button></div>
                        )}
                    </div>
                </div>
            );
        }

        function Empilhador_Tool({ onExit }) {
            const [currentView, setCurrentView] = useState('welcome');
            const [users, setUsers] = useState([]);
            const [activeUser, setActiveUser] = useState(null);

            useEffect(() => { const s = localStorage.getItem('miniApp_treasureMap_users_v2'); if (s) setUsers(JSON.parse(s)); }, []);
            const save = (u) => { setUsers(u); localStorage.setItem('miniApp_treasureMap_users_v2', JSON.stringify(u)); };
            const createUser = (n, g) => { const u = { id: Date.now().toString(), name: n, goal: g, currentAmount: 0, history: [] }; const list = [...users, u]; save(list); setActiveUser(u); setCurrentView('app-home'); };
            const updateUser = (amt, hist) => { if(!activeUser) return; const u = { ...activeUser, currentAmount: amt, history: hist }; setActiveUser(u); save(users.map(us => us.id === u.id ? u : us)); };

            return (
                <div className="relative w-full h-full">
                    <div className="fixed bottom-6 left-1/2 -translate-x-1/2 z-[100] w-full max-w-xs flex justify-center pointer-events-none"><button onClick={onExit} className="pointer-events-auto bg-slate-900/90 backdrop-blur-md text-white px-6 py-3 rounded-full shadow-2xl border border-slate-700/50 flex items-center gap-2 font-bold text-sm hover:scale-105 active:scale-95 transition-all"><LayoutGrid size={16} className="text-emerald-400" /> Menu Principal</button></div>
                    {currentView === 'welcome' && <div className="w-full h-full bg-slate-900 text-white p-8 flex flex-col justify-between items-center text-center pb-24 overflow-y-auto"><div className="mt-12"><Mountain size={48} className="text-emerald-400 mb-6 mx-auto" /><h1 className="text-3xl font-bold mb-3">Empilhador</h1><p className="text-slate-400 text-sm">A jornada comeﾃｧa com o primeiro tijolo.</p></div><button onClick={() => setCurrentView('user-select')} className="w-full bg-emerald-500 text-slate-900 font-bold py-4 rounded-xl">Iniciar Jornada</button></div>}
                    {currentView === 'user-select' && <div className="w-full h-full bg-white p-6 flex flex-col pb-24 overflow-y-auto"><h2 className="text-xl font-bold text-slate-800 mb-6">Quem vai empilhar?</h2><div className="space-y-3 flex-1">{users.map(u => <button key={u.id} onClick={() => { setActiveUser(u); setCurrentView('app-home'); }} className="w-full p-4 border rounded-xl flex justify-between items-center"><span className="font-bold text-slate-800">{u.name}</span><span className="text-xs text-slate-500">{formatCurrency(u.currentAmount)}</span></button>)}</div><button onClick={() => setCurrentView('create-user')} className="w-full bg-slate-900 text-white py-3 rounded-xl mt-4">Criar Novo Perfil</button></div>}
                    {currentView === 'create-user' && <Empilhador_CreateUser onBack={() => setCurrentView('user-select')} onCreate={createUser} />}
                    {activeUser && <Empilhador_InternalDashboard user={activeUser} onUpdateData={updateUser} onLogout={() => { setActiveUser(null); setCurrentView('user-select'); }} view={currentView} setView={setCurrentView} />}
                </div>
            );
        }

        // ==========================================
        // 2. DETECTOR
        // ==========================================
        const DETECTOR_CATEGORIES = [
            { id: 'delivery', name: 'Delivery', icon: <ShoppingBag />, color: '#F43F5E', question: 'Mﾃｩdia mensal com iFood?' },
            { id: 'vices', name: 'Vﾃｭcios', icon: <Coffee />, color: '#F59E0B', question: 'Cafﾃｩ, doces, lanches na rua?' },
            { id: 'subs', name: 'Assinaturas', icon: <Smartphone />, color: '#8B5CF6', question: 'Apps que vocﾃｪ mal usa?' },
            { id: 'transport', name: 'Transporte', icon: <Car />, color: '#3B82F6', question: 'Uber nﾃ｣o planejado?' },
            { id: 'fees', name: 'Taxas', icon: <CreditCard />, color: '#64748B', question: 'Tarifas bancﾃ｡rias?' }
        ];

        function Detector_Tool({ onExit }) {
            const [step, setStep] = useState('intro');
            const [idx, setIdx] = useState(0);
            const [expenses, setExpenses] = useState({});
            const [income, setIncome] = useState({ salary: '', hours: 8 });

            const handleVal = (v) => setExpenses({ ...expenses, [DETECTOR_CATEGORIES[idx].id]: parseFloat(v) || 0 });
            const next = () => { if (idx < DETECTOR_CATEGORIES.length - 1) setIdx(idx + 1); else setStep('result'); };
            const total = Object.values(expenses).reduce((a, b) => a + b, 0) * 12;
            const chartData = DETECTOR_CATEGORIES.map(c => ({ name: c.name, value: (expenses[c.id] || 0) * 12, fill: c.color })).filter(d => d.value > 0);

            return (
                <div className="relative w-full h-full bg-white font-sans overflow-y-auto pb-24">
                    <div className="fixed bottom-6 left-1/2 -translate-x-1/2 z-[100] w-full max-w-xs flex justify-center pointer-events-none"><button onClick={onExit} className="pointer-events-auto bg-slate-900/90 backdrop-blur-md text-white px-6 py-3 rounded-full shadow-2xl border border-slate-700/50 flex items-center gap-2 font-bold text-sm hover:scale-105 active:scale-95 transition-all"><LayoutGrid size={16} className="text-emerald-400" /> Menu Principal</button></div>
                    {step === 'intro' && <div className="p-8 text-center flex flex-col h-full justify-center"><div className="mb-6 mx-auto bg-slate-900 p-4 rounded-full text-emerald-400"><Search size={32} /></div><h1 className="text-2xl font-bold text-slate-800 mb-2">Detector de Ralo</h1><p className="text-slate-500 mb-8">Onde seu dinheiro estﾃ｡ vazando?</p><button onClick={() => setStep('config')} className="w-full bg-slate-900 text-white py-4 rounded-xl font-bold">Comeﾃｧar</button></div>}
                    {step === 'config' && <div className="p-8 flex flex-col h-full justify-center"><h2 className="text-xl font-bold text-slate-800 mb-4">Sua Renda</h2><input type="number" placeholder="Salﾃ｡rio Lﾃｭquido" className="w-full p-4 border rounded-xl mb-4 text-slate-900" value={income.salary} onChange={e => setIncome({ ...income, salary: e.target.value })} /><button onClick={() => setStep('audit')} className="w-full bg-emerald-600 text-white py-4 rounded-xl font-bold">Continuar</button></div>}
                    {step === 'audit' && <div className="p-8 flex flex-col h-full pt-12"><div className="h-1 bg-slate-100 w-full mb-8"><div className="h-full bg-emerald-500 transition-all" style={{ width: `${((idx + 1) / DETECTOR_CATEGORIES.length) * 100}%` }}></div></div><div className="text-center mb-8"><div className="mx-auto mb-4 w-12 h-12 flex items-center justify-center rounded-xl" style={{ backgroundColor: DETECTOR_CATEGORIES[idx].color + '20', color: DETECTOR_CATEGORIES[idx].color }}>{DETECTOR_CATEGORIES[idx].icon}</div><h2 className="text-xl font-bold text-slate-800">{DETECTOR_CATEGORIES[idx].name}</h2><p className="text-slate-500 text-sm mt-2">{DETECTOR_CATEGORIES[idx].question}</p></div><input type="number" autoFocus placeholder="R$ 0" className="w-full text-center text-4xl font-bold border-b-2 border-slate-200 py-4 outline-none text-slate-900" value={expenses[DETECTOR_CATEGORIES[idx].id] || ''} onChange={e => handleVal(e.target.value)} /><button onClick={next} className="w-full bg-slate-900 text-white py-4 rounded-xl font-bold mt-auto">Prﾃｳximo</button></div>}
                    {step === 'result' && <div className="p-8 h-full bg-slate-900 text-white flex flex-col"><h2 className="text-center text-slate-400 text-xs uppercase font-bold tracking-widest mb-2">Desperdﾃｭcio Anual</h2><div className="text-center text-5xl font-black mb-8">R$ {total.toLocaleString('pt-BR')}</div><div className="bg-white rounded-xl p-4 flex-1 text-slate-900"><h3 className="font-bold mb-4">Raio-X</h3><div className="h-64"><ResponsiveContainer width="100%" height="100%"><BarChart data={chartData} layout="vertical"><XAxis type="number" hide /><YAxis type="category" dataKey="name" width={80} tick={{ fontSize: 10 }} /><Bar dataKey="value" radius={[0, 4, 4, 0]}><LabelList dataKey="value" position="right" /><Cell fill="#8884d8" /></Bar></BarChart></ResponsiveContainer></div><button onClick={() => { setExpenses({}); setStep('intro'); setIdx(0); }} className="w-full mt-4 py-3 border rounded-xl text-slate-500">Refazer</button></div></div>}
                </div>
            );
        }

        // ==========================================
        // 3. CALCULADORA 2.0
        // ==========================================
        function Calculadora_Tool({ onExit }) {
            const [mode, setMode] = useState('daily');
            const [target, setTarget] = useState(10000);
            const [current, setCurrent] = useState(0);
            const [daily, setDaily] = useState('');
            const [date, setDate] = useState('');
            const [useInterest, setUseInterest] = useState(false);
            const [rate, setRate] = useState(0.8);
            const [workdays, setWorkdays] = useState(false);
            const [result, setResult] = useState(null);

            const calc = (e) => {
                e.preventDefault();
                let acc = parseFloat(current), days = 0, data = [];
                const dailyRate = useInterest ? (Math.pow(1 + (rate / 100), 1 / 30) - 1) : 0;
                
                if (mode === 'daily') {
                    if (!daily) return;
                    while (acc < target && days < 3650) {
                        days++;
                        if (useInterest) acc += acc * dailyRate;
                        if (!workdays || (days % 7 !== 0 && days % 7 !== 6)) acc += parseFloat(daily);
                        if (days % 30 === 0) data.push({ d: days, v: acc });
                    }
                } else {
                     // Lﾃｳgica simplificada para data
                     const diff = Math.ceil((new Date(date) - new Date()) / (1000 * 60 * 60 * 24));
                     days = diff;
                     const req = (target - current) / diff; // Simplificado sem juros para solver rﾃ｡pido
                     for(let i=0; i<diff; i+=30) data.push({d:i, v: current + (req*i)});
                }
                setResult({ days, data });
            };

            return (
                <div className="relative w-full h-full bg-slate-50 overflow-y-auto pb-24">
                    <div className="fixed bottom-6 left-1/2 -translate-x-1/2 z-[100] w-full max-w-xs flex justify-center pointer-events-none"><button onClick={onExit} className="pointer-events-auto bg-slate-900/90 backdrop-blur-md text-white px-6 py-3 rounded-full shadow-2xl border border-slate-700/50 flex items-center gap-2 font-bold text-sm hover:scale-105 active:scale-95 transition-all"><LayoutGrid size={16} className="text-emerald-400" /> Menu Principal</button></div>
                    <div className="bg-white p-6 shadow-sm mb-6"><h1 className="text-2xl font-bold text-slate-900">Calculadora 2.0</h1></div>
                    <div className="px-6 space-y-4">
                        <div className="flex bg-white p-1 rounded-xl shadow-sm border"><button onClick={() => setMode('daily')} className={cn("flex-1 py-2 rounded-lg text-sm font-bold", mode === 'daily' ? "bg-indigo-100 text-indigo-700" : "text-slate-500")}>Valor Diﾃ｡rio</button><button onClick={() => setMode('date')} className={cn("flex-1 py-2 rounded-lg text-sm font-bold", mode === 'date' ? "bg-indigo-100 text-indigo-700" : "text-slate-500")}>Data Limite</button></div>
                        <div className="bg-white p-6 rounded-xl shadow-sm border space-y-4">
                            <div><label className="text-xs font-bold text-slate-400 uppercase">Meta (R$)</label><input type="number" value={target} onChange={e => setTarget(e.target.value)} className="w-full p-3 border rounded-xl text-lg font-bold text-slate-900" /></div>
                            <div><label className="text-xs font-bold text-slate-400 uppercase">Jﾃ｡ Tenho (R$)</label><input type="number" value={current} onChange={e => setCurrent(e.target.value)} className="w-full p-3 border rounded-xl text-lg font-bold text-slate-900" /></div>
                            {mode === 'daily' ? <div><label className="text-xs font-bold text-slate-400 uppercase">Aporte Diﾃ｡rio</label><input type="number" value={daily} onChange={e => setDaily(e.target.value)} className="w-full p-3 border rounded-xl text-lg font-bold text-slate-900" /></div> : <div><label className="text-xs font-bold text-slate-400 uppercase">Data</label><input type="date" value={date} onChange={e => setDate(e.target.value)} className="w-full p-3 border rounded-xl text-lg font-bold text-slate-900" /></div>}
                             <div onClick={() => setUseInterest(!useInterest)} className="flex items-center gap-2 p-3 border rounded-xl cursor-pointer"><div className={cn("w-5 h-5 border rounded flex items-center justify-center", useInterest ? "bg-emerald-500 border-emerald-500" : "bg-white")}><Check size={14} className="text-white" /></div><span className="text-sm font-bold text-slate-700">Investindo (Juros)</span></div>
                             {useInterest && <input type="number" value={rate} onChange={e => setRate(e.target.value)} className="w-full p-2 border rounded-lg text-slate-900" placeholder="Taxa %" />}
                             <button onClick={calc} className="w-full bg-indigo-600 text-white font-bold py-4 rounded-xl shadow-lg">Calcular</button>
                        </div>
                        {result && <div className="bg-slate-900 text-white p-6 rounded-xl text-center"><p className="text-indigo-200 text-xs uppercase">Resultado</p><h2 className="text-4xl font-bold">{result.days} Dias</h2><div className="h-48 w-full mt-4"><ResponsiveContainer width="100%" height="100%"><AreaChart data={result.data}><Area type="monotone" dataKey="v" stroke="#4f46e5" fill="#4f46e5" fillOpacity={0.3} /></AreaChart></ResponsiveContainer></div></div>}
                    </div>
                </div>
            );
        }

        // ==========================================
        // 4. GUARDIﾃグ
        // ==========================================
        function Guardiao_Tool({ onExit }) {
            const [view, setView] = useState('input');
            const [salary, setSalary] = useState('');
            const [price, setPrice] = useState('');
            const days = price && salary ? (price / (salary / 22)) : 0;
            const perc = price && salary ? ((price / salary) * 100).toFixed(1) : 0;

            return (
                <div className="relative w-full h-full bg-white flex flex-col justify-center p-6 pb-24 font-sans overflow-y-auto">
                    <div className="fixed bottom-6 left-1/2 -translate-x-1/2 z-[100] w-full max-w-xs flex justify-center pointer-events-none"><button onClick={onExit} className="pointer-events-auto bg-slate-900/90 backdrop-blur-md text-white px-6 py-3 rounded-full shadow-2xl border border-slate-700/50 flex items-center gap-2 font-bold text-sm hover:scale-105 active:scale-95 transition-all"><LayoutGrid size={16} className="text-emerald-400" /> Menu Principal</button></div>
                    {view === 'input' ? (
                        <div className="w-full max-w-md mx-auto space-y-6">
                            <div className="text-center"><div className="w-16 h-16 bg-red-100 rounded-full flex justify-center items-center mx-auto mb-4"><Shield className="text-red-600" size={32} /></div><h2 className="text-2xl font-bold text-slate-800">Guardiﾃ｣o de Bolso</h2></div>
                            <div><label className="text-sm font-bold text-slate-700">Renda Mensal</label><input type="number" value={salary} onChange={e => setSalary(e.target.value)} className="w-full p-4 border rounded-xl text-lg text-slate-900" /></div>
                            <div><label className="text-sm font-bold text-slate-700">Preﾃｧo do Item</label><input type="number" value={price} onChange={e => setPrice(e.target.value)} className="w-full p-4 border rounded-xl text-lg text-slate-900" /></div>
                            <button onClick={() => setView('result')} disabled={!price} className="w-full bg-slate-900 text-white font-bold py-4 rounded-xl">Ver Custo Real</button>
                        </div>
                    ) : (
                        <div className="bg-slate-900 p-8 rounded-2xl text-center text-white w-full max-w-md mx-auto"><h2 className="text-6xl font-black mb-2">{Math.ceil(days)}</h2><p className="text-xl text-slate-300 mb-6">Dias de Trabalho</p><p className="mb-8 text-slate-400">Isso custa <strong>{perc}%</strong> do seu mﾃｪs.</p><button onClick={() => setView('input')} className="w-full bg-emerald-500 py-3 rounded-xl font-bold mb-3">Desisti (Venci!)</button><button onClick={() => setView('input')} className="w-full border border-slate-700 py-3 rounded-xl text-slate-400">Comprar mesmo assim</button></div>
                    )}
                </div>
            );
        }

        // ==========================================
        // 5. GERADOR DE Nﾃグ
        // ==========================================
        function Gerador_Tool({ onExit }) {
            const [txt, setTxt] = useState('');
            const scripts = { amigo: ["Cara, tﾃｴ num aperto agora.", "Meu dinheiro tﾃ｡ preso em investimento."], parente: ["Nﾃ｣o misturo dinheiro com famﾃｭlia.", "Tive gastos imprevistos."], colega: ["Nﾃ｣o empresto por regra pessoal.", "Tﾃｴ zerado esse mﾃｪs."] };
            const gen = (w) => { const l = scripts[w]; setTxt(l[Math.floor(Math.random() * l.length)]); };

            return (
                <div className="relative w-full h-full bg-white p-6 pb-24 font-sans overflow-y-auto">
                    <div className="fixed bottom-6 left-1/2 -translate-x-1/2 z-[100] w-full max-w-xs flex justify-center pointer-events-none"><button onClick={onExit} className="pointer-events-auto bg-slate-900/90 backdrop-blur-md text-white px-6 py-3 rounded-full shadow-2xl border border-slate-700/50 flex items-center gap-2 font-bold text-sm hover:scale-105 active:scale-95 transition-all"><LayoutGrid size={16} className="text-emerald-400" /> Menu Principal</button></div>
                    <div className="text-center mb-8"><div className="w-16 h-16 bg-indigo-100 rounded-2xl flex justify-center items-center mx-auto mb-4"><ShieldBan className="text-purple-600" size={32} /></div><h1 className="text-2xl font-bold text-slate-900">Gerador de Nﾃグ</h1></div>
                    {!txt ? (
                        <div className="space-y-4 max-w-md mx-auto"><p className="text-slate-500 font-bold">Quem pediu?</p><button onClick={() => gen('amigo')} className="w-full p-4 border rounded-xl flex items-center gap-3 font-bold text-slate-700 hover:bg-slate-50"><Users className="text-emerald-500" /> Amigo</button><button onClick={() => gen('parente')} className="w-full p-4 border rounded-xl flex items-center gap-3 font-bold text-slate-700 hover:bg-slate-50"><Home className="text-blue-500" /> Parente</button><button onClick={() => gen('colega')} className="w-full p-4 border rounded-xl flex items-center gap-3 font-bold text-slate-700 hover:bg-slate-50"><Briefcase className="text-purple-500" /> Colega</button></div>
                    ) : (
                        <div className="max-w-md mx-auto animate-fade-in"><div className="bg-slate-900 text-white p-6 rounded-2xl italic text-lg mb-6 relative"><Quote className="absolute top-4 left-4 opacity-20" size={40} />"{txt}"</div><button onClick={() => { navigator.clipboard.writeText(txt); alert('Copiado!'); }} className="w-full bg-emerald-500 text-white font-bold py-4 rounded-xl mb-3 flex justify-center gap-2"><Copy /> Copiar</button><button onClick={() => setTxt('')} className="w-full border py-4 rounded-xl font-bold text-slate-500">Voltar</button></div>
                    )}
                </div>
            );
        }

        // ==========================================
        // LAUNCHER
        // ==========================================
        function Launcher({ onLaunch }) {
            return (
                <div className="w-full h-full bg-slate-900 text-white p-6 animate-fade-in pb-24 font-sans overflow-y-auto">
                    <header className="mb-8 mt-4 flex justify-between items-center shrink-0"><div><h1 className="text-2xl font-extrabold">10k em Silﾃｪncio</h1><p className="text-slate-400 text-xs font-bold uppercase">Super App</p></div><div className="bg-emerald-500/20 p-2 rounded-full border border-emerald-500/30 text-emerald-400"><Crown size={20} /></div></header>
                    <div className="grid grid-cols-2 gap-4 mb-8">
                        <button onClick={() => onLaunch('empilhador')} className="bg-slate-800 p-5 rounded-2xl border border-slate-700 text-left hover:bg-slate-700 transition-colors group"><Mountain size={32} className="text-emerald-400 mb-3 group-hover:scale-110 transition-transform" /><h3 className="font-bold text-lg">Empilhador</h3><p className="text-xs text-slate-400">Construa patrimﾃｴnio</p></button>
                        <button onClick={() => onLaunch('detector')} className="bg-slate-800 p-5 rounded-2xl border border-slate-700 text-left hover:bg-slate-700 transition-colors group"><Search size={32} className="text-amber-400 mb-3 group-hover:scale-110 transition-transform" /><h3 className="font-bold text-lg">Detector</h3><p className="text-xs text-slate-400">Ache vazamentos</p></button>
                    </div>
                    <h2 className="text-xs font-bold text-slate-500 uppercase tracking-widest mb-4">Bﾃｴnus</h2>
                    <div className="space-y-3">
                        <button onClick={() => onLaunch('calc')} className="w-full bg-slate-800/50 p-4 rounded-xl border border-slate-700/50 flex items-center gap-4 hover:bg-slate-800"><div className="bg-indigo-500/20 p-2 rounded text-indigo-400"><Lock size={20} /></div><div className="text-left"><h3 className="font-bold">Calculadora 2.0</h3></div><ArrowRight className="ml-auto text-slate-600" size={16} /></button>
                        <button onClick={() => onLaunch('guardiao')} className="w-full bg-slate-800/50 p-4 rounded-xl border border-slate-700/50 flex items-center gap-4 hover:bg-slate-800"><div className="bg-red-500/20 p-2 rounded text-red-400"><Shield size={20} /></div><div className="text-left"><h3 className="font-bold">Guardiﾃ｣o</h3></div><ArrowRight className="ml-auto text-slate-600" size={16} /></button>
                        <button onClick={() => onLaunch('gerador')} className="w-full bg-slate-800/50 p-4 rounded-xl border border-slate-700/50 flex items-center gap-4 hover:bg-slate-800"><div className="bg-purple-500/20 p-2 rounded text-purple-400"><ShieldBan size={20} /></div><div className="text-left"><h3 className="font-bold">Gerador de Nﾃグ</h3></div><ArrowRight className="ml-auto text-slate-600" size={16} /></button>
                    </div>
                </div>
            );
        }

        // ==========================================
        // ROOT
        // ==========================================
        function SuperApp() {
            const [active, setActive] = useState(null);
            return (
                <>
                    <InstallPrompt />
                    {active === null && <Launcher onLaunch={setActive} />}
                    {active === 'empilhador' && <Empilhador_Tool onExit={() => setActive(null)} />}
                    {active === 'detector' && <Detector_Tool onExit={() => setActive(null)} />}
                    {active === 'calc' && <Calculadora_Tool onExit={() => setActive(null)} />}
                    {active === 'guardiao' && <Guardiao_Tool onExit={() => setActive(null)} />}
                    {active === 'gerador' && <Gerador_Tool onExit={() => setActive(null)} />}
                </>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<SuperApp />);
    </script>
</body>
</html>
